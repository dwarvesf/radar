"use strict";var _interopRequireDefault=require("@babel/runtime-corejs2/helpers/interopRequireDefault");exports.__esModule=true;exports.default=void 0;var _asyncToGenerator2=_interopRequireDefault(require("@babel/runtime-corejs2/helpers/asyncToGenerator"));var _router=_interopRequireDefault(require("next/router"));var _onDemandEntriesUtils=require("./on-demand-entries-utils");var _this=void 0;var _default=/*#__PURE__*/function(){var _ref2=(0,_asyncToGenerator2.default)(function*(_ref){let{assetPrefix}=_ref;_router.default.ready(()=>{_router.default.events.on('routeChangeComplete',_onDemandEntriesUtils.setupPing.bind(_this,assetPrefix,()=>_router.default.pathname));});(0,_onDemandEntriesUtils.setupPing)(assetPrefix,()=>_router.default.pathname,_onDemandEntriesUtils.currentPage);// prevent HMR connection from being closed when running tests
if(!process.env.__NEXT_TEST_MODE){document.addEventListener('visibilitychange',event=>{const state=document.visibilityState;if(state==='visible'){(0,_onDemandEntriesUtils.setupPing)(assetPrefix,()=>_router.default.pathname,true);}else{(0,_onDemandEntriesUtils.closePing)();}});}});return function(_x){return _ref2.apply(this,arguments);};}();exports.default=_default;